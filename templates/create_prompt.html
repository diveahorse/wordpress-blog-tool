{% extends "base.html" %}

{% block title %}プロンプトテンプレート作成 - WordPressブログ管理ツール{% endblock %}

{% block extra_css %}
<style>
.prompt-editor {
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
    line-height: 1.6;
    min-height: 400px;
    resize: vertical;
}

.template-examples {
    max-height: 300px;
    overflow-y: auto;
}

.template-example {
    cursor: pointer;
    transition: background-color 0.2s ease;
}

.template-example:hover {
    background-color: #f8f9fa;
}

.template-example.selected {
    background-color: #e3f2fd;
    border-left: 4px solid #2196f3;
}
</style>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item">
                            <a href="{{ url_for('prompts') }}">
                                <i class="fas fa-file-alt me-1"></i>プロンプト管理
                            </a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">新規作成</li>
                    </ol>
                </nav>
                <h1 class="h3 mb-1">
                    <i class="fas fa-plus me-2"></i>プロンプトテンプレート作成
                </h1>
                <p class="text-muted mb-0">
                    新しいプロンプトテンプレートを作成します
                </p>
            </div>
            <a href="{{ url_for('prompts') }}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-1"></i>戻る
            </a>
        </div>

        <!-- AI Generation Section -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-magic me-2"></i>AIによるプロンプト生成
                </h5>
            </div>
            <div class="card-body">
                <p class="text-muted mb-3">
                    AIを使用してプロンプトテンプレートを自動生成できます。
                </p>
                
                <form id="aiGenerationForm">
                    <!-- 記事テーマ設定 -->
                    <div class="row mb-3">
                        <div class="col-12">
                            <div class="mb-3">
                                <label for="articleTheme" class="form-label">記事テーマ例 *</label>
                                <input type="text" class="form-control" id="articleTheme" name="articleTheme" 
                                       placeholder="例: 健康な食事の作り方、効率的な時間管理術、AI技術の最新動向" required>
                                <div class="form-text">
                                    このプロンプトで生成する記事のテーマ例を入力してください。AIがより適切なプロンプトを生成するために使用されます。
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 基本設定 -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="promptType" class="form-label">プロンプトタイプ *</label>
                                <select class="form-select" id="promptType" name="promptType" required>
                                    <option value="">選択してください</option>
                                    <option value="ニュース記事">ニュース記事</option>
                                    <option value="レビュー記事">レビュー記事</option>
                                    <option value="ハウツー記事">ハウツー記事</option>
                                    <option value="技術解説記事">技術解説記事</option>
                                    <option value="コラム記事">コラム記事</option>
                                    <option value="インタビュー記事">インタビュー記事</option>
                                    <option value="比較記事">比較記事</option>
                                    <option value="まとめ記事">まとめ記事</option>
                                    <option value="ランキング記事">ランキング記事</option>
                                    <option value="その他">その他</option>
                                </select>
                                <div class="form-text">
                                    作成したいプロンプトの種類を選択してください。
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="targetAudience" class="form-label">ターゲット読者</label>
                                <select class="form-select" id="targetAudience" name="targetAudience">
                                    <option value="">選択してください</option>
                                    <option value="初心者">初心者</option>
                                    <option value="中級者">中級者</option>
                                    <option value="上級者">上級者</option>
                                    <option value="ビジネスパーソン">ビジネスパーソン</option>
                                    <option value="学生">学生</option>
                                    <option value="主婦・主夫">主婦・主夫</option>
                                    <option value="シニア">シニア</option>
                                    <option value="一般向け">一般向け</option>
                                    <option value="専門家">専門家</option>
                                </select>
                                <div class="form-text">
                                    想定する読者層を選択してください。
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 記事設定 -->
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="contentStyle" class="form-label">コンテンツスタイル</label>
                                <select class="form-select" id="contentStyle" name="contentStyle">
                                    <option value="">選択してください</option>
                                    <option value="親しみやすく、分かりやすい">親しみやすく、分かりやすい</option>
                                    <option value="専門的で詳細">専門的で詳細</option>
                                    <option value="カジュアルで軽快">カジュアルで軽快</option>
                                    <option value="フォーマルで丁寧">フォーマルで丁寧</option>
                                    <option value="ユーモアを交えた">ユーモアを交えた</option>
                                    <option value="説明的で論理的">説明的で論理的</option>
                                </select>
                                <div class="form-text">
                                    記事のトーンやスタイルを選択してください。
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="articleLength" class="form-label">記事の長さ</label>
                                <select class="form-select" id="articleLength" name="articleLength">
                                    <option value="">選択してください</option>
                                    <option value="短め（1000字程度）">短め（1000字程度）</option>
                                    <option value="標準（2000字程度）">標準（2000字程度）</option>
                                    <option value="長め（3000字程度）">長め（3000字程度）</option>
                                    <option value="詳細（5000字以上）">詳細（5000字以上）</option>
                                </select>
                                <div class="form-text">
                                    生成する記事の長さを選択してください。
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="articleStructure" class="form-label">記事構成</label>
                                <select class="form-select" id="articleStructure" name="articleStructure">
                                    <option value="">選択してください</option>
                                    <option value="導入→本文→まとめ">導入→本文→まとめ</option>
                                    <option value="問題提起→解決策→まとめ">問題提起→解決策→まとめ</option>
                                    <option value="比較→分析→結論">比較→分析→結論</option>
                                    <option value="時系列順">時系列順</option>
                                    <option value="重要度順">重要度順</option>
                                    <option value="ランキング形式">ランキング形式</option>
                                    <option value="カスタム構成">カスタム構成</option>
                                </select>
                                <div class="form-text">
                                    記事の構成パターンを選択してください。
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ランキング形式設定 -->
                    <div class="row" id="rankingSettings" style="display: none;">
                        <div class="col-12">
                            <div class="card border-primary">
                                <div class="card-header bg-primary text-white">
                                    <h6 class="mb-0">
                                        <i class="fas fa-trophy me-2"></i>ランキング形式設定
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="rankingCount" class="form-label">ランキング数</label>
                                                <select class="form-select" id="rankingCount" name="rankingCount">
                                                    <option value="">選択してください</option>
                                                    <option value="3">3位</option>
                                                    <option value="5">5位</option>
                                                    <option value="10">10位</option>
                                                    <option value="15">15位</option>
                                                    <option value="20">20位</option>
                                                    <option value="25">25位</option>
                                                    <option value="30">30位</option>
                                                    <option value="50">50位</option>
                                                </select>
                                                <div class="form-text">
                                                    ランキングの上位何位までを紹介するか選択してください。
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="rankingCriteria" class="form-label">ランキング基準</label>
                                                <select class="form-select" id="rankingCriteria" name="rankingCriteria">
                                                    <option value="">選択してください</option>
                                                    <option value="人気度・売上">人気度・売上</option>
                                                    <option value="品質・評価">品質・評価</option>
                                                    <option value="コストパフォーマンス">コストパフォーマンス</option>
                                                    <option value="機能性">機能性</option>
                                                    <option value="デザイン性">デザイン性</option>
                                                    <option value="実用性">実用性</option>
                                                    <option value="革新性">革新性</option>
                                                    <option value="信頼性">信頼性</option>
                                                    <option value="カスタム基準">カスタム基準</option>
                                                </select>
                                                <div class="form-text">
                                                    ランキングの評価基準を選択してください。
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="rankingFormat" class="form-label">ランキング形式</label>
                                                <select class="form-select" id="rankingFormat" name="rankingFormat">
                                                    <option value="">選択してください</option>
                                                    <option value="順位→商品名→説明→評価">順位→商品名→説明→評価</option>
                                                    <option value="順位→商品名→特徴→メリット・デメリット">順位→商品名→特徴→メリット・デメリット</option>
                                                    <option value="順位→商品名→詳細レビュー→価格">順位→商品名→詳細レビュー→価格</option>
                                                    <option value="順位→商品名→比較表→総合評価">順位→商品名→比較表→総合評価</option>
                                                    <option value="カスタム形式">カスタム形式</option>
                                                </select>
                                                <div class="form-text">
                                                    各ランキング項目の表示形式を選択してください。
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="rankingElements" class="form-label">ランキング要素</label>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="includeRankingNumber" name="includeRankingNumber" value="true" checked>
                                                    <label class="form-check-label" for="includeRankingNumber">
                                                        順位番号を表示
                                                    </label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="includeProductImage" name="includeProductImage" value="true">
                                                    <label class="form-check-label" for="includeProductImage">
                                                        商品画像の説明を含める
                                                    </label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="includePrice" name="includePrice" value="true">
                                                    <label class="form-check-label" for="includePrice">
                                                        価格情報を含める
                                                    </label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="includeRating" name="includeRating" value="true">
                                                    <label class="form-check-label" for="includeRating">
                                                        評価・スコアを含める
                                                    </label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="includeComparison" name="includeComparison" value="true">
                                                    <label class="form-check-label" for="includeComparison">
                                                        他商品との比較を含める
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12">
                                            <div class="mb-3">
                                                <label for="rankingIntroduction" class="form-label">ランキング導入文</label>
                                                <textarea class="form-control" id="rankingIntroduction" name="rankingIntroduction" rows="2"
                                                          placeholder="例: 今回は【テーマ】について、実際に使用した経験や調査結果に基づいて厳選したランキングをご紹介します。"></textarea>
                                                <div class="form-text">
                                                    ランキング記事の導入部分のテンプレートを入力してください。
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- SEO・技術設定 -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="seoRequirements" class="form-label">SEO要件</label>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="seoOptimization" name="seoOptimization" value="true">
                                    <label class="form-check-label" for="seoOptimization">
                                        SEO最適化を含める
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="keywordOptimization" name="keywordOptimization" value="true">
                                    <label class="form-check-label" for="keywordOptimization">
                                        キーワード最適化を含める
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="metaDescription" name="metaDescription" value="true">
                                    <label class="form-check-label" for="metaDescription">
                                        メタディスクリプション生成を含める
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="headingStructure" name="headingStructure" value="true">
                                    <label class="form-check-label" for="headingStructure">
                                        見出し構造の指定を含める
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="contentElements" class="form-label">コンテンツ要素</label>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="includeExamples" name="includeExamples" value="true">
                                    <label class="form-check-label" for="includeExamples">
                                        具体例を含める
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="includeTips" name="includeTips" value="true">
                                    <label class="form-check-label" for="includeTips">
                                        実践的なTipsを含める
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="includeStatistics" name="includeStatistics" value="true">
                                    <label class="form-check-label" for="includeStatistics">
                                        統計データを含める
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="includeCallToAction" name="includeCallToAction" value="true">
                                    <label class="form-check-label" for="includeCallToAction">
                                        行動喚起を含める
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 追加要件 -->
                    <div class="row">
                        <div class="col-12">
                            <div class="mb-3">
                                <label for="additionalRequirements" class="form-label">追加要件・特別な指示</label>
                                <textarea class="form-control" id="additionalRequirements" name="additionalRequirements" rows="3"
                                          placeholder="例: &#10;- 専門用語は必ず説明を入れる&#10;- 読者の行動を促す文章にする&#10;- 信頼性の高い情報源を参照する&#10;- 特定の業界向けに調整する"></textarea>
                                <div class="form-text">
                                    特別な要件や指示があれば詳細に入力してください。
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary" id="generateBtn">
                            <i class="fas fa-magic me-2"></i>AIでプロンプトを生成
                        </button>
                    </div>
                </form>
                
                <!-- Generation Progress -->
                <div id="generationProgress" class="mt-3" style="display: none;">
                    <div class="progress mb-2">
                        <div id="generationProgressBar" class="progress-bar progress-bar-striped progress-bar-animated" 
                             role="progressbar" style="width: 0%"></div>
                    </div>
                    <p id="generationStatus" class="text-muted mb-0 small">AIがプロンプトを生成中...</p>
                </div>
            </div>
        </div>

        <form id="createPromptForm">
            <!-- Template Name -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-tag me-2"></i>テンプレート名
                    </h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="templateName" class="form-label">テンプレート名 *</label>
                        <input type="text" class="form-control" id="templateName" name="templateName" 
                               placeholder="例: ニュース記事用、レビュー記事用、技術解説用" required>
                        <div class="form-text">
                            テンプレートの用途や特徴を表す名前を入力してください。
                        </div>
                    </div>
                </div>
            </div>

            <!-- Template Content -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-code me-2"></i>テンプレート内容
                    </h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="templateContent" class="form-label">プロンプト内容 *</label>
                        <textarea class="form-control prompt-editor" id="templateContent" name="templateContent" 
                                  placeholder="プロンプトテンプレートの内容を入力してください。&#10;&#10;例:&#10;あなたはプロのWebライターです。&#10;以下の【テーマ】について記事を書いてください。&#10;&#10;#テーマ&#10;{theme}&#10;&#10;#要件&#10;- 文字数: 2000字程度&#10;- 構成: 導入、本文、まとめ&#10;- トーン: 親しみやすく、分かりやすい" required></textarea>
                        <div class="form-text">
                            記事生成に使用するプロンプトテンプレートを入力してください。{theme}は記事のテーマに置き換えられます。
                        </div>
                    </div>
                </div>
            </div>

            <!-- Template Examples -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-lightbulb me-2"></i>テンプレート例
                    </h5>
                </div>
                <div class="card-body">
                    <p class="text-muted mb-3">
                        以下のテンプレート例を参考にしてください。クリックすると内容がコピーされます。
                    </p>
                    <div class="template-examples">
                        <div class="template-example p-3 border rounded mb-2" onclick="loadExample('basic')">
                            <h6 class="mb-2">基本的な記事テンプレート</h6>
                            <p class="text-muted small mb-0">
                                一般的なブログ記事用のシンプルなテンプレート
                            </p>
                        </div>
                        <div class="template-example p-3 border rounded mb-2" onclick="loadExample('review')">
                            <h6 class="mb-2">レビュー記事テンプレート</h6>
                            <p class="text-muted small mb-0">
                                商品やサービスのレビュー記事用テンプレート
                            </p>
                        </div>
                        <div class="template-example p-3 border rounded mb-2" onclick="loadExample('howto')">
                            <h6 class="mb-2">ハウツー記事テンプレート</h6>
                            <p class="text-muted small mb-0">
                                手順や方法を説明する記事用テンプレート
                            </p>
                        </div>
                        <div class="template-example p-3 border rounded mb-2" onclick="loadExample('news')">
                            <h6 class="mb-2">ニュース記事テンプレート</h6>
                            <p class="text-muted small mb-0">
                                最新ニュースや情報を伝える記事用テンプレート
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Submit Buttons -->
            <div class="card">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('prompts') }}" class="btn btn-outline-secondary">
                            <i class="fas fa-times me-1"></i>キャンセル
                        </a>
                        <button type="submit" class="btn btn-primary" id="submitBtn">
                            <i class="fas fa-save me-1"></i>テンプレートを作成
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// テンプレート例の定義
const templateExamples = {
    basic: {
        name: "基本的な記事テンプレート",
        content: `あなたはプロのWebライターです。
以下の【テーマ】について記事を書いてください。

#テーマ
{theme}

#要件
- 文字数: 2000字程度
- 構成: 導入、本文、まとめ
- トーン: 親しみやすく、分かりやすい
- 読者: 一般向け

#構成
1. 導入（テーマの概要）
2. 本文（詳細な説明）
3. まとめ（要点の整理）

#注意事項
- SEOを意識したタイトルと見出し
- 読みやすい文章構成
- 具体例やデータを含める`
    },
    review: {
        name: "レビュー記事テンプレート",
        content: `あなたはプロのレビュアーです。
以下の【テーマ】について詳細なレビュー記事を書いてください。

#テーマ
{theme}

#レビュー構成
1. 商品・サービス概要
2. 主な特徴・機能
3. メリット・デメリット
4. 実際の使用体験
5. 価格・コストパフォーマンス
6. 対象ユーザー
7. 総合評価・おすすめ度

#要件
- 文字数: 2500字程度
- 客観的な評価
- 具体的な使用例
- 比較検討を含める
- 読者の判断材料を提供`
    },
    howto: {
        name: "ハウツー記事テンプレート",
        content: `あなたはプロのインストラクターです。
以下の【テーマ】について、初心者でも分かる手順書を書いてください。

#テーマ
{theme}

#構成
1. 概要・目的
2. 必要な準備・材料
3. 手順（ステップバイステップ）
4. 注意点・コツ
5. よくある失敗と対処法
6. 応用・発展

#要件
- 文字数: 2000字程度
- 分かりやすい手順説明
- 図解や例を想定した説明
- 初心者向けの配慮
- 安全面の注意事項`
    },
    news: {
        name: "ニュース記事テンプレート",
        content: `あなたはプロのニュースライターです。
以下の【テーマ】について、最新のニュース記事を書いてください。

#テーマ
{theme}

#構成
1. ヘッドライン（重要な情報）
2. リード（概要・要点）
3. 背景・経緯
4. 詳細な内容
5. 影響・今後の展望
6. 関連情報・参考資料

#要件
- 文字数: 1800字程度
- 客観的な事実報道
- 最新情報の正確性
- 読者の関心を引く構成
- 信頼性の高い情報源`
    }
};

// テンプレート例を読み込み
function loadExample(type) {
    if (templateExamples[type]) {
        const example = templateExamples[type];
        document.getElementById('templateName').value = example.name;
        document.getElementById('templateContent').value = example.content;
        
        // 選択状態を視覚的に表示
        document.querySelectorAll('.template-example').forEach(el => {
            el.classList.remove('selected');
        });
        event.currentTarget.classList.add('selected');
        
        // フォーカスを移動
        document.getElementById('templateContent').focus();
    }
}

// ランキング形式設定の表示/非表示を制御
function toggleRankingSettings() {
    const articleStructure = document.getElementById('articleStructure').value;
    const promptType = document.getElementById('promptType').value;
    const rankingSettings = document.getElementById('rankingSettings');
    
    if (articleStructure === 'ランキング形式' || promptType === 'ランキング記事') {
        rankingSettings.style.display = 'block';
    } else {
        rankingSettings.style.display = 'none';
    }
}

// 記事構成とプロンプトタイプの変更を監視
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('articleStructure').addEventListener('change', toggleRankingSettings);
    document.getElementById('promptType').addEventListener('change', toggleRankingSettings);
});

// AI生成フォーム送信処理
document.getElementById('aiGenerationForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const articleTheme = document.getElementById('articleTheme').value.trim();
    const promptType = document.getElementById('promptType').value.trim();
    const targetAudience = document.getElementById('targetAudience').value.trim();
    const contentStyle = document.getElementById('contentStyle').value.trim();
    const articleLength = document.getElementById('articleLength').value.trim();
    const articleStructure = document.getElementById('articleStructure').value.trim();
    const seoOptimization = document.getElementById('seoOptimization').checked;
    const keywordOptimization = document.getElementById('keywordOptimization').checked;
    const metaDescription = document.getElementById('metaDescription').checked;
    const headingStructure = document.getElementById('headingStructure').checked;
    const includeExamples = document.getElementById('includeExamples').checked;
    const includeTips = document.getElementById('includeTips').checked;
    const includeStatistics = document.getElementById('includeStatistics').checked;
    const includeCallToAction = document.getElementById('includeCallToAction').checked;
    const additionalRequirements = document.getElementById('additionalRequirements').value.trim();
    
    // ランキング設定の値を取得
    const rankingCount = document.getElementById('rankingCount').value.trim();
    const rankingCriteria = document.getElementById('rankingCriteria').value.trim();
    const rankingFormat = document.getElementById('rankingFormat').value.trim();
    const includeRankingNumber = document.getElementById('includeRankingNumber').checked;
    const includeProductImage = document.getElementById('includeProductImage').checked;
    const includePrice = document.getElementById('includePrice').checked;
    const includeRating = document.getElementById('includeRating').checked;
    const includeComparison = document.getElementById('includeComparison').checked;
    const rankingIntroduction = document.getElementById('rankingIntroduction').value.trim();
    
    if (!articleTheme) {
        alert('記事テーマ例を入力してください。');
        return;
    }
    if (!promptType) {
        alert('プロンプトタイプを選択してください。');
        return;
    }
    
    // 生成ボタンを無効化
    const generateBtn = document.getElementById('generateBtn');
    generateBtn.disabled = true;
    generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>生成中...';
    
    // 進捗表示を開始
    const progressDiv = document.getElementById('generationProgress');
    const progressBar = document.getElementById('generationProgressBar');
    const statusText = document.getElementById('generationStatus');
    
    progressDiv.style.display = 'block';
    progressBar.style.width = '0%';
    statusText.textContent = 'AIがプロンプトを生成中...';
    
    // 進捗アニメーション
    let progress = 0;
    const progressInterval = setInterval(() => {
        progress += Math.random() * 15;
        if (progress > 90) progress = 90;
        progressBar.style.width = progress + '%';
    }, 500);
    
    // APIに送信
    fetch('/prompts/generate', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            article_theme: articleTheme,
            prompt_type: promptType,
            target_audience: targetAudience,
            content_style: contentStyle,
            article_length: articleLength,
            article_structure: articleStructure,
            seo_optimization: seoOptimization,
            keyword_optimization: keywordOptimization,
            meta_description: metaDescription,
            heading_structure: headingStructure,
            include_examples: includeExamples,
            include_tips: includeTips,
            include_statistics: includeStatistics,
            include_call_to_action: includeCallToAction,
            additional_requirements: additionalRequirements,
            ranking_count: rankingCount,
            ranking_criteria: rankingCriteria,
            ranking_format: rankingFormat,
            include_ranking_number: includeRankingNumber,
            include_product_image: includeProductImage,
            include_price: includePrice,
            include_rating: includeRating,
            include_comparison: includeComparison,
            ranking_introduction: rankingIntroduction
        })
    })
    .then(response => response.json())
    .then(data => {
        clearInterval(progressInterval);
        progressBar.style.width = '100%';
        statusText.textContent = '生成完了！';
        
        if (data.success) {
            // 生成された内容をフォームに設定
            document.getElementById('templateName').value = data.suggested_name;
            document.getElementById('templateContent').value = data.content;
            
            // 成功メッセージを表示
            if (data.message) {
                alert(data.message);
            } else {
                alert('AIがプロンプトを生成しました！');
            }
            
            // 自動的に保存するか確認
            if (confirm('生成されたプロンプトを自動的に保存しますか？')) {
                // 自動保存
                fetch('/prompts/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        name: data.suggested_name,
                        content: data.content
                    })
                })
                .then(response => response.json())
                .then(saveData => {
                    if (saveData.success) {
                        alert('プロンプトを自動保存しました！');
                        window.location.href = '/prompts';
                    } else {
                        alert('自動保存に失敗しました: ' + saveData.error);
                        progressDiv.style.display = 'none';
                    }
                })
                .catch(error => {
                    alert('自動保存でエラーが発生しました: ' + error);
                    progressDiv.style.display = 'none';
                });
            } else {
                // 手動保存の場合は内容を表示
                setTimeout(() => {
                    progressDiv.style.display = 'none';
                    alert('内容を確認してから手動で保存してください。');
                }, 1000);
            }
        } else {
            alert('エラー: ' + data.error);
            progressDiv.style.display = 'none';
        }
    })
    .catch(error => {
        clearInterval(progressInterval);
        alert('エラーが発生しました: ' + error);
        progressDiv.style.display = 'none';
    })
    .finally(() => {
        // ボタンを元に戻す
        generateBtn.disabled = false;
        generateBtn.innerHTML = '<i class="fas fa-magic me-2"></i>AIでプロンプトを生成';
    });
});

// フォーム送信処理
document.getElementById('createPromptForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const templateName = document.getElementById('templateName').value.trim();
    const templateContent = document.getElementById('templateContent').value.trim();
    
    if (!templateName || !templateContent) {
        alert('テンプレート名と内容を入力してください。');
        return;
    }
    
    // 送信ボタンを無効化
    const submitBtn = document.getElementById('submitBtn');
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>作成中...';
    
    // APIに送信
    fetch('/prompts/create', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            name: templateName,
            content: templateContent
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('テンプレートを作成しました！');
            window.location.href = '/prompts';
        } else {
            alert('エラー: ' + data.error);
        }
    })
    .catch(error => {
        alert('エラーが発生しました: ' + error);
    })
    .finally(() => {
        // ボタンを元に戻す
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<i class="fas fa-save me-1"></i>テンプレートを作成';
    });
});
</script>
{% endblock %}
